name: Deploy Staging

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    lint:
        name: Deploy
        runs-on: ubuntu-latest
        steps:
        - name: Checkout code
          uses: actions/checkout@v3

        - uses: ok-nick/setup-aftman@v0.3.0
          name: Install aftman
          with:
              token: ${{ SECRETS.GITHUB_TOKEN }}
        
        - name: Build Place
          run: rojo build -o build.rbxlx

        - name: Publish Dev
          shell: bash
          env:
            UID: 6546639287
            PID: 124901411861642
            API_KEY: ${{ secrets.PUBLISHING_API_KEY }}
            FILE: build.rbxlx
          run: rbxcloud experience publish -a "$API_KEY" -u "$UID" -p "$PID" -t published -f "$FILE"